# Minimal NGINX configuration for a Single Page Application (SPA)

server {
    # NGINX listens on port 80, which is the default for Cloud Run containers
    listen 80;

    # Set the root directory to the location where we copied the built assets
    root /usr/share/nginx/html;

    # Default file to serve when a directory is requested
    index index.html;

    # The crucial part for React Router/SPAs
    location / {
        # 1. Try to serve the requested URI exactly (e.g., /logo.png)
        # 2. If not found, try to serve it as a directory (e.g., /images/)
        # 3. If still not found, FALLBACK to /index.html
        # This allows React Router to take over and handle the route (e.g., /listing/123)
        try_files $uri $uri/ /index.html;
    }

    # Optionally, configure caching for static assets for better performance
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|eot|ttf|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # NGINX error handling configuration (optional but recommended)
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
